<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=Windows-1251">

</HEAD>

<BODY BGCOLOR="#FFFFFF" TEXT="#000000">

</OBJECT>

<H1><A NAME="idh_cfgmodem"></A>Конфигурация модемов</H1>

<h2>General Commands</h2>

<P>В <A HREF="guigrid.html">сетке ввода строк</A> содержатся управляющие строки (последовательности/команды) модема. В строках, посылаемых модему, можно указывать управляющие спецсимволы, которые описаны в отдельной главе <A HREF="modemctlchars.html">Управляющие символы модема</A>.</P>

<TABLE cols=3 width=615>

<TR VALIGN="top">
<TD width=14%>Init</TD>
<TD width=20%>
<PRE><CODE>ATZ|</CODE></PRE>
</TD>
<TD width=*>Строка инициализации модема. Посылается при запуске линии, по окончании сеанса связи, каждые две минуты вне сеансов (для проверки модема), и, перед набором номера.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Answer</TD>
<TD width=20%>
<PRE><CODE>ATA!</CODE></PRE>
</TD>
<TD width=*>Строка, посылаемая модему по обнаружению сигнала RING. После посылки этой строки происходит переход линии в режим ожидания соединения.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Dial prefix</TD>
<TD width=20%>
<PRE><CODE>ATDP</CODE></PRE>
</TD>
<TD width=*>Префикс команды набора номера. Полная команда набора номера состоит из префикса, собственно номера и суффикса,</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Dial suffix</TD>
<TD width=20%>
<PRE><CODE>!</CODE></PRE>
</TD>
<TD width=*>Суффикс команды набора номера. Суффикс в большинстве случаев состоит из единственного символа ! (спецсимвол CR без ожидания)</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Hangup</TD>
<TD width=20%>
<PRE><CODE>~~+++~~`AT|ATH|</CODE></PRE></TD>
<TD width=*>Команда физического отсоединения. Данная строка после секундной задержки переводит модем в командный режим, выдерживает паузу и ждет ответа OK модема, после чего разрывает соединение. Команда AT предназначена для ускорения срабатывания в случае, если модем успел перейти в командный режим еще до выдачи последовательности +++.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Info</TD>
<TD width=20%><I>пустая</I></TD>
<TD width=*>Команда информации модема посылается после успешного завершения сессии. Результат записывается в лог. Можно использовать атом Response Log Format для
форматирования вывода.. По умолчанию не определена, поэтому команда информации не посылается.</TD>
</TR>

</TABLE><BR>

<P>Необходимо иметь в виду особенности работы с модемом средствами <A HREF="tapi.html">TAPI</A>. В этом режиме управление модемом ведется централизованно операционной системой.  Поэтому следует разделять настройки модема в режиме TAPI и при работе через COM-порт. Рекомендуется создать на закладке Modems несколько модемов с собственными управляющими последовательностями. Ниже приведен пример настройки управляющих команд при работе через TAPI.</P>

<TABLE cols=3 width=615>

<TR VALIGN="top">
<TD width=14%>Init</TD>
<TD width=20%>
<PRE><CODE>AT|</CODE></PRE>
</TD>
<TD width=*>Windows инициализирует модем собственной командой, поэтому некоторые специфические параметры настройки модема следует указывать в строках ответа на звонок или префикса набора номера. Это не касается тех параметров, которые Windows не изменяет.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Answer</TD>
<TD width=20%>
<PRE><CODE>ATA!</CODE></PRE>
</TD>
<TD width=*>Строка ответа.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Dial prefix</TD>
<TD width=20%>
<PRE><CODE>ATDP</CODE></PRE>
</TD>
<TD width=*>Префикс команды набора номера.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Dial suffix</TD>
<TD width=20%>
<PRE><CODE>!</CODE></PRE>
</TD>
<TD width=*>Суффикс команды набора номера.</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Hangup</TD>
<TD width=20%>
<PRE><CODE>^v~~~^</CODE></PRE></TD>
<TD width=*>В режиме TAPI Windows инициализирует модем таким образом, чтобы он производил отсоединение по опусканию сигнала DTR (обычно это делается командой AT&D2). Символ ^ в начале строки гарантирует последующий сброс DTR.
</TD>
</TR>

<TR VALIGN="top">
<TD width=14%>Info</TD>
<TD width=20%><I>пустая</I></TD>
<TD width=*>Команда информации модема.</TD>
</TR>

</TABLE><BR>

<P>При необходимости автоматической смены настроек можно использовать <A HREF="atoms.html">атом</A> Replace Modem или набор атомов Modem Command Answer, Modem Command Prefix, Modem Command Hangup. </P>

<P>См. также <A HREF="cfgserial.html">Настройка коммуникационных портов</A> и <A HREF="asyncflow.html">Контроль потока данных</A></P>

<h2>Responses</h2>

<P><A HREF="guigrid.html">Сетка</A> ввода стандартных строк ответов модема. В каждом поле можно перечислить через пробел несколько вариантов ответа для данного типа. Сам же символ пробела в строке ответа заменяется на символ подчеркивания. You may not use wildcards but may use <A HREF="regexp.html">Regular Expressions</A> here.</P>

<h2>Flags</h2>

<P>Перед прозвонкой на узел с определенными флагами (которые указаны в <A HREF="oftnnodelist.html">списке узлов</A> или непосредственно в настройках узлов в Радиусе), можно инициализировать модем для использования других протоколов соединения, то есть использовать иные Init string / Dial Prefix / Dial Suffix,  нежели описаны в General Commands.</P>

<P>В поле первой колонки (Flag list) перечисляются флаги, во второй (Init/Prefix/Suffix) - замещенные Init string / Dial Prefix / Dial Suffix.</P>

<P>Флаги в поле Flag List можно перечислять, используя логические операции <I>ИЛИ / И</I>. "Пробел" означает <I>ИЛИ</I>, "запятая" - <I>И</I>. Приоритет <I>И</I> выше.</P>

<P>Пример перечисления флагов с использованием логических операций.</P>

<TABLE cols=2 width=430>

<TR VALIGN="top">
<TD width=42%>Поле колонки flags list</TD>
<TD width=58%>Трактовка</TD>
</TR>

<TR VALIGN="top">
<TD width=42%>
<PRE><CODE>PEP</CODE></PRE>
</TD>
<TD width=58%><CODE>PEP</CODE></TD>
</TR>

<TR VALIGN="top">
<TD width=42%>
<PRE><CODE>HST H16</CODE></PRE>
</TD>
<TD width=58%><CODE>HST</CODE> или <CODE>H16</CODE></TD>
</TR>

<TR VALIGN="top">
<TD width=42%>
<PRE><CODE>V32B,V42B</CODE></PRE>
</TD>
<TD width=58%><CODE>V32B</CODE> вместе с <CODE>V42B</CODE></TD>
</TR>

<TR VALIGN="top">
<TD width=42%>
<PRE><CODE>ZYX,V34 32T</CODE></PRE>
</TD>
<TD width=58%>или <CODE>ZYX</CODE> вместе с <CODE>V34</CODE>, или <CODE>V32T</CODE></TD>
</TR>
</TABLE><BR>

<P>В поле второй колонки (Init/Prefix/Suffix) таблицы Flags перечисляются через дробь: Init String, Dial Prefix и Dial Suffix. Одиночная точка на месте Dial Prefix и Dial Suffix интерпретируется как соответствующее значение из General Commands.</P>

<P>Пример формирования строк инициализации модема и набора номера, на основе значений сеток General Commands и Flags List:</P>

<TABLE cols=2 width=615>

<TR VALIGN="top">
<TD width=19%>Номер телефона</TD>
<TD width=81%><CODE>323323</CODE></TD>
</TR>
</TABLE><BR>

<P>Значения General Commands</P>

<TABLE cols=2 width=309>

<TR VALIGN="top">
<TD width=38%>Init</TD>
<TD width=62%>
<PRE><CODE>ATZ|</CODE></PRE>
</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>    Dial Prefix</TD>
<TD width=62%>
<PRE><CODE>ATDP</CODE></PRE>
</TD>
</TR>

<TR VALIGN="top">
<TD width=38%>Dial Suffix</TD>
<TD width=62%>
<PRE><CODE>!</CODE></PRE>
</TD>
</TR>
</TABLE><BR>

<TABLE cols=4 width=657>

<TR VALIGN="top">
<TD width=20%>Значение поля колонки Flags List</TD>
<TD width=13%>Строка инициализации перед прозвонкой</TD>
<TD width=22%>Строка набора номера</TD>
<TD width=45%>Комментарий</TD>
</TR>

<TR VALIGN="top">
<TD width=20%>
<PRE><CODE>ATB1|/ATM0DP/!</CODE></PRE>
</TD>
<TD width=13%>
<PRE><CODE>ATB1|</CODE></PRE>
</TD>
<TD width=22%>
<PRE><CODE>ATDP323323!</CODE></PRE>
</TD>
<TD width=45%>Init string - <CODE>ATB1|</CODE>
<P>Prefix - <CODE>ATM0DP</CODE></P>

<P>Suffix - <CODE>!</CODE></P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=20%>
<PRE><CODE>ATM0|/ATDT</CODE></PRE>
</TD>
<TD width=13%>
<PRE><CODE>ATM0|</CODE></PRE>
</TD>
<TD width=22%>
<PRE><CODE>ATDT323323!</CODE></PRE>
</TD>
<TD width=45%>Init string - <CODE>ATM0|</CODE>
<P>Prefix - <CODE>ATDT</CODE></P>

<P>Suffix - <CODE>!</CODE></P>
</TD>
</TR>

<TR VALIGN="top">
<TD width=20%>
<PRE><CODE>ATH1|</CODE></PRE>
</TD>
<TD width=13%>
<PRE><CODE>ATH1|</CODE></PRE>
</TD>
<TD width=22%>
<PRE><CODE>ATDP323323!</CODE></PRE>
</TD>
<TD width=45%>Префикс и суффикс опущены - берем их из General Commands</TD>
</TR>

<TR VALIGN="top">
<TD width=20%>
<PRE><CODE>/ATX7DP/@!</CODE></PRE>
</TD>
<TD width=13%>&nbsp;</TD>
<TD width=22%>
<PRE><CODE>ATX7DP323323@!</CODE></PRE>
</TD>
<TD width=45%>Одиночная точка на месте строки инициализации - строка инициализации пуста</TD>
</TR>

<TR VALIGN="top">
<TD width=20%>
<PRE><CODE>ATB0|/./@!</CODE></PRE>
</TD>
<TD width=13%>
<PRE><CODE>ATB0|</CODE></PRE>
</TD>
<TD width=22%>
<PRE><CODE>ATDP323323@!</CODE></PRE>
</TD>
<TD width=45%>Одиночная точка на месте Dial Prefix - берем его из General Commands</TD>
</TR>
</TABLE><BR>

<h2>External Fax Receiver</h2>

<P>Изменять значение этого поля необходимо только тогда, когда Вы намерены использовать данный модем, кроме передачи файлов, еще и для <A HREF="fax.html">приема факсов</A>. </P>

</BODY>
</HTML>
